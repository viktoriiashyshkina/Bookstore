<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Book Store</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
  <style>

#authorDisplayContainer
  #categoryDisplayContainer {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.author-pill,
.category-pill {
  display: inline-block;
  padding: 5px 10px;
  background-color: #f1f1f1;
  border: 1px solid #ccc;
  border-radius: 20px;
  font-size: 14px;
  color: #333;
  min-width: 2px; /* Smallest size to maintain appearance */
  width: auto;
}



    .book-container {
        display: flex;
        align-items: flex-start;
        margin: 20px 0;
        border-bottom: 1px solid #ccc;
        padding-bottom: 20px;
        max-width: 900px;
    }

    .container {
    max-width: 1200px;
    margin: 0 auto;
}

    .book-image {
        width: 150px;
        height: 200px;
        background-color: #f0f0f0;
        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.1rem;
        color: #888;
        margin-right: 20px;
    }

    .book-info {
        flex-grow: 1;
    }

    .book-title {
        font-size: 1.5rem;
        font-weight: bold;
    }

    .book-author {
        color: #666;
        margin-bottom: 10px;
        font-size: 0.9rem;
    }

    .add-book-container,
    .edit-book-container {
        display: none;
        border: 1px solid #ccc;
        padding: 20px;
        margin-top: 20px;
        border-radius: 8px;
        background-color: #f9f9f9;
    }



    .image-upload {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 15px;
    }

    .image-upload-frame {
        width: 150px;
        height: 200px;
        display: flex;
        justify-content: center;
        align-items: center;
        border: 1px dashed #888;
        background-color: #f0f0f0;
        cursor: pointer;
        font-size: 2rem;
        color: #666;
        position: relative;
    }

    .image-upload-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
}
.upload-icon-container {
    position: absolute;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.3);
        opacity: 0;
    transition: opacity 0.3s ease;
    }

    .upload-icon-container:hover {
    opacity: 1;
}


    .upload-icon {
    font-size: 2rem;
    color: #666;
}


    .image-preview {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: none;
    }
  </style>
  <script>






    function setDeleteBookId(bookId) {
    // Update the hidden input with the selected book ID
    document.getElementById('deleteBookId').value = bookId;

    // Optionally log for debugging
    console.log("Book ID set for deletion: ", bookId);
  }


<!--      function setDeleteBookId(bookId) {-->
<!--      // Update the hidden input with the book ID-->
<!--      document.getElementById('deleteBookId').value = bookId;-->

<!--      // Dynamically update the form's action URL-->
<!--      const deleteForm = document.getElementById('deleteBookForm');-->
<!--      deleteForm.action = `/books/delete/${bookId}`;-->
<!--    }-->


<!--  // Store the book ID temporarily when the delete button is clicked-->
<!--let bookIdToDelete = null;-->

<!--function setDeleteBookId(bookId) {-->
<!--  bookIdToDelete = bookId;-->
<!--  // Update the form action dynamically based on the selected book ID-->
<!--  const deleteForm = document.getElementById('deleteBookForm');-->
<!--  deleteForm.action = `/books/delete/${bookIdToDelete}`;-->
<!--}-->

let categoryList = []; // Global array to store categories

// Submit the category from the modal
function submitCategory() {
  const categoryInput = document.getElementById('categoryInput').value.trim();

  if (categoryInput) {
    // Add category to the global list
    categoryList.push(categoryInput);

    // Create a "pill" for the category
    const categoryPill = document.createElement('div');
    categoryPill.className = 'category-pill';
    categoryPill.textContent = categoryInput;

    // Append the pill to the display container
    document.getElementById('categoryDisplayContainer').appendChild(categoryPill);

    // Update the hidden input with the comma-separated list
    const hiddenInput = document.querySelector('input[name="categoryList"]');
    hiddenInput.value = categoryList.join(',');

    // Close the modal after submission
    closeCategoryModal();
  }
}

// Open the category modal
function openCategoryModal() {
  document.getElementById('categoryModal').style.display = 'block';
}

// Close the category modal
function closeCategoryModal() {
  document.getElementById('categoryModal').style.display = 'none';
  document.getElementById('categoryInput').value = ''; // Clear the input field
}



let authorList = []; // Global array to store categories

// Submit the author from the modal
function submitAuthor() {
  const authorInput = document.getElementById('authorInput').value.trim();

  if (authorInput) {
    // Add category to the global list
    authorList.push(authorInput);

    // Create a "pill" for the category
    const authorPill = document.createElement('div');
    authorPill.className = 'author-pill';
    authorPill.textContent = authorInput;

    // Append the pill to the display container
    document.getElementById('authorDisplayContainer').appendChild(authorPill);

    // Update the hidden input with the comma-separated list
    const hiddenInput = document.querySelector('input[name="authorList"]');
    hiddenInput.value = authorList.join(',');

    // Close the modal after submission
    closeAuthorModal();
  }
}

// Open the category modal
function openAuthorModal() {
  document.getElementById('authorModal').style.display = 'block';
}

// Close the category modal
function closeAuthorModal() {
  document.getElementById('authorModal').style.display = 'none';
  document.getElementById('authorInput').value = ''; // Clear the input field
}




function openEditCategoryModal(bookId) {
  // Open the category modal for the given book
  document.getElementById(`editCategoryModal-${bookId}`).style.display = 'block';
}


function closeEditCategoryModal(bookId) {
  // Close the category modal for the given book
  document.getElementById(`editCategoryModal-${bookId}`).style.display = 'none';
  // Clear the category input
  document.getElementById(`editCategoryInput-${bookId}`).value = '';
}

<!--function submitEditCategory(bookId) {-->
<!--  const categoryInput = document.getElementById(`editCategoryInput-${bookId}`).value.trim();-->
<!--  if (categoryInput) {-->
<!--    // Get the container for displaying categories-->
<!--    const categoryDisplayContainer = document.getElementById(`editCategoryDisplayContainer-${bookId}`);-->
<!--    // Create a new category pill-->
<!--    const categoryPill = document.createElement('div');-->
<!--    categoryPill.className = 'category-pill';-->
<!--    categoryPill.textContent = categoryInput;-->
<!--    categoryDisplayContainer.appendChild(categoryPill);-->

<!--    // Get the hidden input storing the list of categories-->
<!--    const hiddenInput = document.querySelector(`[name="editCategoryList-${bookId}"]`);-->
<!--    // Parse the existing categories, append the new one, and update the input value-->
<!--    let categories = hiddenInput.value ? hiddenInput.value.split(',') : [];-->
<!--    categories.push(categoryInput);-->
<!--    hiddenInput.value = categories.join(',');-->

<!--    // Close the modal-->
<!--    closeEditCategoryModal(bookId);-->
<!--  }-->
<!--}-->







function submitEditCategory(bookId) {
  const categoryInput = document.getElementById(`editCategoryInput-${bookId}`).value.trim();
  if (categoryInput) {
    // Get the container for displaying categories
    const categoryDisplayContainer = document.getElementById(`editCategoryDisplayContainer-${bookId}`);

    // Create a new category pill
    const categoryPill = document.createElement('div');
    categoryPill.className = 'd-flex align-items-center me-2 category-pill';
    categoryPill.innerHTML = `
      <input type="text" class=" form-control me-2" value="${categoryInput}" placeholder="Enter category" oninput="updateCategoryList('${bookId}')">
      <button type="button" class="btn btn-danger btn-sm" onclick="removeCategory('${bookId}', this)">Remove</button>
    `;
    categoryDisplayContainer.appendChild(categoryPill);

    // Get the hidden input storing the list of categories
    const hiddenInput = document.getElementById(`editCategoryList-${bookId}`);
    // Parse the existing categories, append the new one, and update the input value
    let categories = hiddenInput.value ? hiddenInput.value.split(',') : [];
    categories.push(categoryInput);
    hiddenInput.value = categories.join(',');

    // Close the modal
    closeEditCategoryModal(bookId);
    }
}






function updateEditCategoryList(bookId, button) {
  // Get the input field for the category being updated
  const categoryInput = button.previousElementSibling;
  const newValue = categoryInput.value.trim();

  // Get the hidden input storing the list of categories
  const hiddenInput = document.getElementById(`editCategoryList-${bookId}`);

  // Parse the existing categories, update the changed one, and update the input value
  let categories = hiddenInput.value ? hiddenInput.value.split(',') : [];
  const index = categories.findIndex(cat => cat === categoryInput.value);
  if (index !== -1) {
    categories[index] = newValue;
    hiddenInput.value = categories.join(',');
  }

  // Update the category display
  categoryInput.value = newValue;
}



<!--function updateEditCategoryList(bookId) {-->
<!--  // Get the input fields in the editCategoryDisplayContainer-->
<!--  const categoryInputs = document.querySelectorAll(`#editCategoryDisplayContainer-${bookId} input.category-pill`);-->

<!--  // Create an array of the current category values-->
<!--  const categoryValues = Array.from(categoryInputs).map(input => input.value);-->

<!--  // Update the editCategoryList input field with the new values-->
<!--  const editCategoryListInput = document.getElementById(`editCategoryList-${bookId}`);-->
<!--  editCategoryListInput.value = categoryValues.join(',');-->
<!--}-->




function updateCategoryList(bookId) {
  // Get the input fields in the editCategoryDisplayContainer
  const categoryInputs = document.querySelectorAll(`#editCategoryDisplayContainer-${bookId} input.form-control`);

  // Create an array of the current category values
  const categoryValues = Array.from(categoryInputs).map(input => input.value);

  // Update the editCategoryList input field with the new values
  const editCategoryListInput = document.getElementById(`editCategoryList-${bookId}`);
  editCategoryListInput.value = categoryValues.join(',');
}


function removeCategory(bookId, categoryInput) {
  // Get the container for displaying categories
  const categoryDisplayContainer = document.getElementById(`editCategoryDisplayContainer-${bookId}`);

  // Find the category pill element and remove it
  const categoryPill = categoryInput.closest('.category-pill');
  categoryDisplayContainer.removeChild(categoryPill);

  // Get the hidden input storing the list of categories
  const hiddenInput = document.getElementById(`editCategoryList-${bookId}`);

  // Parse the existing categories, remove the deleted one, and update the input value
  let categories = hiddenInput.value ? hiddenInput.value.split(',') : [];
  const index = categories.findIndex(cat => cat === categoryInput.value.trim());
  if (index !== -1) {
    categories.splice(index, 1);
    hiddenInput.value = categories.join(',');
  }

  updateCategoryList(bookId);
}

<!--function removeCategory(event) {-->
<!--  const button = event.target;-->
<!--  const bookId = button.getAttribute('data-book-id');-->
<!--  const categoryInput = button.previousElementSibling;-->

<!--  // Get the container for displaying categories-->
<!--  const categoryDisplayContainer = document.getElementById(`editCategoryDisplayContainer-${bookId}`);-->

<!--  // Find the category pill element and remove it-->
<!--  const categoryPill = categoryInput.closest('.category-pill');-->
<!--  categoryDisplayContainer.removeChild(categoryPill);-->

<!--  // Get the hidden input storing the list of categories-->
<!--  const hiddenInput = document.getElementById(`editCategoryList-${bookId}`);-->

<!--  // Parse the existing categories, remove the deleted one, and update the input value-->
<!--  let categories = hiddenInput.value ? hiddenInput.value.split(',') : [];-->
<!--  const index = categories.findIndex(cat => cat === categoryInput.value.trim());-->
<!--  if (index !== -1) {-->
<!--    categories.splice(index, 1);-->
<!--    hiddenInput.value = categories.join(',');-->
<!--  }-->
<!--}-->







function openEditAuthorModal(bookId) {
  // Open the author modal for the given book
  document.getElementById(`editAuthorModal-${bookId}`).style.display = 'block';
}

function closeEditAuthorModal(bookId) {
  // Close the author modal for the given book
  document.getElementById(`editAuthorModal-${bookId}`).style.display = 'none';
  // Clear the author input
  document.getElementById(`editAuthorInput-${bookId}`).value = '';
}

function submitEditAuthor(bookId) {
  const authorInput = document.getElementById(`editAuthorInput-${bookId}`).value.trim();
  if (authorInput) {
<!--    // Get the container for displaying authors-->
<!--    const authorDisplayContainer = document.getElementById(`editAuthorDisplayContainer-${bookId}`);-->
<!--    // Create a new author pill-->
<!--    const authorPill = document.createElement('div');-->
<!--    authorPill.className = 'author-pill';-->
<!--    authorPill.textContent = authorInput;-->
<!--    authorDisplayContainer.appendChild(authorPill);-->

    // Get the hidden input storing the list of authors
    const hiddenInput = document.querySelector(`[name="editAuthorList-${bookId}"]`);
    // Parse the existing authors, append the new one, and update the input value
    let authors = hiddenInput.value ? hiddenInput.value.split(',') : [];
    authors.push(authorInput);
    hiddenInput.value = authors.join(',');

    // Close the modal
    closeEditAuthorModal(bookId);
  }
}




    // Toggle Add Book Form visibility
    function toggleAddBook() {
        const container = document.getElementById("addBookContainer");
        container.style.display = container.style.display === "none" ? "block" : "none";
    }


    // Toggle Edit Book Form visibility for a specific book
    function toggleEditBook(bookId) {
        const editContainer = document.getElementById(`editBookContainer-${bookId}`);

        // Toggle the visibility of the corresponding edit container
        if (editContainer) {
            const isCurrentlyVisible = editContainer.style.display === "block";
            editContainer.style.display = isCurrentlyVisible ? "none" : "block";
        }
    }


function removePill(bookId, categoryPill) {
  // Get the container for displaying categories
  const categoryDisplayContainer = document.getElementById(`editCategoryDisplayContainer-${bookId}`);

  // Find the category pill element and remove it
  categoryDisplayContainer.removeChild(categoryPill.closest('.category-pill'))
  }




    // Preview the uploaded image
    function previewImage(event, previewId) {
        const reader = new FileReader();
        reader.onload = function() {
            const output = document.getElementById(previewId);
            output.src = reader.result;
            output.style.display = 'block';
        };
        reader.readAsDataURL(event.target.files[0]);
    }
  </script>
</head>
<body>
<div class="container">
  <h1 class="my-4">Book Store</h1>

  <!-- Add Book Button -->
  <div class="d-flex justify-content-start">
    <button type="button" class="btn btn-primary mb-3" onclick="toggleAddBook()">+ Add Book</button>
  </div>

<!--   Add Book Form-->
  <div id="addBookContainer" class="add-book-container">
    <form th:action="@{/books/add}" method="post" enctype="multipart/form-data">
      <div class="image-upload">
        <label for="imageUpload" class="image-upload-frame">
          <span id="uploadIcon" style="display: block;">+</span>
          <img id="imagePreview" class="image-preview" alt="Preview">
        </label>
        <input type="file" id="imageUpload" name="image" accept="image/*" onchange="previewImage(event, 'imagePreview')" style="display: none;">
      </div>

      <input type="text" class="form-control mb-3" name="title" placeholder="Add title" required>


      <div class="form-group">
        <!-- Container for displaying added authors -->
        <div id="authorDisplayContainer" class="d-flex flex-wrap mb-3"></div>

        <!-- + Category Button -->
        <button type="button" class="btn btn-secondary" onclick="openAuthorModal()">+ Author</button>

        <!-- Hidden input to store the final list of categories -->
        <input  type="hidden" name="authorList">
      </div>

      <!-- Modal for entering an author-->
      <div id="authorModal" class="modal" tabindex="-1" style="display: none;">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Add Author</h5>
              <button type="button" class="btn-close" onclick="closeAuthorModal()" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <p>Please enter an author:</p>
              <input type="text" id="authorInput" class="form-control" placeholder="Enter author">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" onclick="submitAuthor()">Submit</button>
            </div>
          </div>
        </div>
      </div>



<!--      <input type="text" class="form-control mb-3" name="author" placeholder="Add author" required>-->




      <div class="form-group">
        <!-- Container for displaying added categories -->
        <div id="categoryDisplayContainer" class="d-flex flex-wrap mb-3"></div>

        <!-- + Category Button -->
        <button type="button" class="btn btn-secondary mb-4" onclick="openCategoryModal()">+ Category</button>

        <!-- Hidden input to store the final list of categories -->
        <input type="hidden" name="categoryList">
      </div>

      <!-- Modal for entering a category -->
      <div id="categoryModal" class="modal" tabindex="-1" style="display: none;">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Add Category</h5>
              <button type="button" class="btn-close" onclick="closeCategoryModal()" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <p>Please enter a category:</p>
              <input type="text" id="categoryInput" class="form-control" placeholder="Enter category">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" onclick="submitCategory()">Submit</button>
            </div>
          </div>
        </div>
      </div>


      <textarea class="form-control mb-3" name="description" placeholder="Add description"></textarea>
      <input type="text" class="form-control mb-3" name="isbn" placeholder="Add ISBN" required>
      <input type="number" step="0.01" class="form-control mb-3" name="price" placeholder="Add price" required>

      <button type="submit" class="btn btn-primary">Save Book</button>
    </form>
  </div>



  <!-- Display Books -->
  <div th:each="book : ${books}" class="book-container">
    <div class="book-image" th:if="${book.image == null}">No picture</div>
<!--    <img th:src="@{${book.image}}" th:if="${book.image != null}" class="book-image" alt="Book Image">-->
    <img th:src="'data:image/jpeg;base64,' + ${book.imageDataBase64}"  th:if="${book.image != null}" class="book-image" alt="Book Image">

    <div class="book-info">
      <div class="book-title" th:text="${book.title}">Book Title</div>
      <p>by
        <span th:each="author, iterStat : ${book.author}"
              th:utext="${author + (iterStat.last ? '' : ', ')}"></span>
      </p>
      <p>Categories:
        <span th:each="category : ${book.category}"
              th:utext="${category + '&nbsp;&nbsp;&nbsp;'}"></span>
      </p>
      <p>ISBN: <span th:text="${book.isbn}">ISBN</span></p>
      <p>Price: $<span th:text="${book.price}">Price</span></p>
      <p>Id: <span th:text="${book.id}">Id</span></p>
    </div>



    <!-- Edit Book Form (Hidden by Default) -->
    <div th:id="|editBookContainer-${book.id}|" class="edit-book-container">
      <form th:action="@{/books/edit/{id}(id=${book.id})}" method="post" enctype="multipart/form-data">


        <div class="image-upload">
          <label th:for="|editImageUpload-${book.id}|" class="image-upload-frame">
            <div class="image-upload-content">
              <!--            <span style="display: block;">+</span>-->
              <img th:id="|editImagePreview-${book.id}|" th:src="'data:image/jpeg;base64,' + ${book.imageDataBase64}" th:if="${book.image != null}" class="image-preview" alt="Preview" style="display: block;">
              <img th:id="|editImagePreview-${book.id}|" src="#" class="image-preview" alt="Preview" style="display: none;">
              <div class="upload-icon-container">
                <span class="upload-icon">+</span>
              </div>
            </div>
          </label>
          <input type="file" th:id="|editImageUpload-${book.id}|" name="image" accept="image/*" th:onchange="|previewImage(event, 'editImagePreview-${book.id}')|" style="display: none;">
        </div>


        <input type="text" class="form-control mb-3" name="title" th:value="${book.title}" required>


<!--        <div class="form-group">-->
<!--          &lt;!&ndash; Container for displaying added authors &ndash;&gt;-->
<!--&lt;!&ndash;          <div th:id="|editAuthorDisplayContainer-${book.id}|" class="d-flex flex-wrap mb-3">&ndash;&gt;-->
<!--&lt;!&ndash;            <div th:each="author : ${book.author}" class="author-pill" th:text="${author}"></div>&ndash;&gt;-->
<!--&lt;!&ndash;          </div>&ndash;&gt;-->

<!--          <input  class="form-control mb-3" th:name="|editAuthorList-${book.id}|" th:value="${#strings.arrayJoin(book.author, ',')}">-->

<!--          &lt;!&ndash; + Author  Button &ndash;&gt;-->
<!--          <button type="button" class="btn btn-secondary" th:onclick="|openEditAuthorModal('${book.id}')|">+ Author</button>-->

<!--        </div>-->



        <div class="form-group d-flex align-items-center" id="displayAuthors">
          <input th:id="|editAuthorList-${book.id}|" class="form-control me-2 mb-4" th:name="|editAuthorList-${book.id}|" th:value="${#strings.arrayJoin(book.author, ',')}">
          <button type="button" class="btn btn-secondary text-nowrap mb-4" th:onclick="|openEditAuthorModal('${book.id}')|">+ Author</button>
        </div>


        <!-- Modal for entering an author -->
        <div th:id="|editAuthorModal-${book.id}|" class="modal" tabindex="-1" style="display: none;">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Add Author</h5>
                <button type="button" class="btn-close" th:onclick="|closeEditAuthorModal('${book.id}')|" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <p>Please enter an author:</p>
                <input type="text" th:id="|editAuthorInput-${book.id}|" class="form-control" placeholder="Enter author">
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-primary" th:onclick="|submitEditAuthor('${book.id}')|">Submit</button>
              </div>
            </div>
          </div>
        </div>




<!--        <div class="form-group" id="displayCategories">-->
<!--          &lt;!&ndash; Container for displaying added categories &ndash;&gt;-->
<!--          <div th:id="|editCategoryDisplayContainer-${book.id}|" class="d-flex flex-wrap mb-3">-->
<!--            <div th:each="category : ${book.category}" class="category-pill" th:text="${category}"></div>-->
<!--          </div>-->

<!--          &lt;!&ndash; + Category Button &ndash;&gt;-->
<!--          <button type="button" class="btn btn-secondary" th:onclick="|openEditCategoryModal('${book.id}')|">+ Category</button>-->

<!--          &lt;!&ndash; Hidden input to store the final list of categories &ndash;&gt;-->
<!--          <input type="hidden" class="form-control mb-3" th:name="|editCategoryList-${book.id}|" th:value="${#strings.arrayJoin(book.category, ',')}">-->
<!--        </div>-->


<!--        <div class="form-group" id="displayCategories">-->
<!--&lt;!&ndash;           Container for displaying added categories as input fields&ndash;&gt;-->
<!--&lt;!&ndash;          <div th:id="|editCategoryDisplayContainer-${book.id}|" class="d-flex flex-wrap mb-3">&ndash;&gt;-->
<!--&lt;!&ndash;            &lt;!&ndash; Iterate through existing categories and display as input fields &ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;            <div th:each="categoryInput: ${book.category}" class=" d-flex align-items-center me-2 category-pill">&ndash;&gt;-->
<!--&lt;!&ndash;              <input type="text"&ndash;&gt;-->
<!--&lt;!&ndash;                     class="form-control me-2"&ndash;&gt;-->
<!--&lt;!&ndash;                     th:value="${categoryInput}"&ndash;&gt;-->
<!--&lt;!&ndash;                     th:id="|editCategoryInput-${book.id}-${categoryInput}|"&ndash;&gt;-->
<!--&lt;!&ndash;                     placeholder="Enter category"&ndash;&gt;-->
<!--&lt;!&ndash;                     th:oninput="|updateCategoryList('${book.id}')|">&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;              <button type="button" class="btn btn-danger btn-sm" onclick="removePill('${bookId}', this)">Remove</button>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;              <button type="button" class="btn btn-danger btn-sm" th:onclick="|updateEditCategoryList('${bookId}',this)|">Change</button>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;              <button type="button" class="btn btn-primary btn-sm" th:onclick="|testButtonClicked('${book.id}', '${categoryInput}')|">Test</button>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;            </div>&ndash;&gt;-->
<!--&lt;!&ndash;          </div>&ndash;&gt;-->


<!--          <input  th:id="|editCategoryList-${book.id}|"  class="form-control mb-3" th:name="|editCategoryList-${book.id}|" th:value="${#strings.arrayJoin(book.category, ',')}">-->


<!--          &lt;!&ndash; + Category Button &ndash;&gt;-->
<!--          <button type="button" class="btn btn-secondary mb-4" th:onclick="|openEditCategoryModal('${book.id}')|">+ Add Category</button>-->

<!--          &lt;!&ndash; Hidden input to store the final list of categories &ndash;&gt;-->
<!--&lt;!&ndash;          <input  th:id="|editCategoryList-${book.id}|"  class="form-control mb-3" th:name="|editCategoryList-${book.id}|" th:value="${#strings.arrayJoin(book.category, ',')}">&ndash;&gt;-->
<!--        </div>-->


        <div class="form-group d-flex align-items-center" id="displayCategories">
          <input th:id="|editCategoryList-${book.id}|" class="form-control me-2 mb-4" th:name="|editCategoryList-${book.id}|" th:value="${#strings.arrayJoin(book.category, ',')}">
          <button type="button" class="btn btn-secondary text-nowrap mb-4" th:onclick="|openEditCategoryModal('${book.id}')|">+ Category</button>
        </div>



        <!-- Modal for entering a category -->
        <div th:id="|editCategoryModal-${book.id}|" class="modal" tabindex="-1" style="display: none;">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Add Category</h5>
                <button type="button" class="btn-close" th:onclick="|closeEditCategoryModal('${book.id}')|" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <p>Please enter a category:</p>
                <input type="text" th:id="|editCategoryInput-${book.id}|" class="form-control" placeholder="Enter category">
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-primary" th:onclick="|submitEditCategory('${book.id}')|">Submit</button>
              </div>
            </div>
          </div>
        </div>


        <textarea class="form-control mb-3" name="description" th:text="${book.description}"></textarea>
        <input type="text" class="form-control mb-3" name="isbn" th:value="${book.isbn}" required>
        <input type="number" step="0.01" class="form-control mb-3" name="price" th:value="${book.price}" required>


          <button type="submit" class="btn btn-primary">Update Book</button>

      </form>
    </div>


    <!-- Button to open the confirmation modal -->
    <div class="d-flex mt-2">
      <button class="btn btn-secondary me-2" th:onclick="|toggleEditBook('${book.id}')|">Edit</button>
            <form th:action="@{/books/delete/{id}(id=${book.id})}" method="post" style="display: inline;">
              <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this book?');">Delete</button>
            </form>
  </div>




  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
</body>
</html>
